# ğŸš€ Azure DevOps CI/CD Pipeline (Stepsâ€‘Only) with Deployment to App Service ğŸ‰

Below is your complete Azure DevOps YAML pipeline using **ONLY steps**, including:

- âœ” Node.js setup
- âœ” npm install
- âœ” Copy files
- âœ” Archive ZIP with build number
- âœ” Publish artifact
- âœ” Deploy to Azure App Service
- âœ” Selfâ€‘hosted agent (nakodtech â†’ Agentâ€‘1)
- âœ” No automatic triggers
- âœ” Added **implicit stage & job explanation** with display names

---

## ğŸ—ï¸ Implicit Stage & Job (Azure DevOps Automatically Creates These)

When you use **steps only**, Azure DevOps builds this structure behind the scenes:

### ğŸŸ¦ Stage Name (implicit): **Stage 1**

### ğŸŸ© Job Name (implicit): **Job**

Everything inside your `steps:` block runs inside:

```
Stage 1 â†’ Job â†’ Steps (your tasks)
```

You do **not** need to write stages or jobs explicitly â€” Azure generates them.

---

## ğŸ› ï¸ Pipeline Configuration

```yaml
trigger:
  - none

pool:
  name: nakodtech
  demands:
    - agent.name -equals Agent-1
```

---

## ğŸ“¦ Step 1 â€” Use Node.js 24

```yaml
- task: NodeTool@0
  inputs:
    versionSource: "spec"
    versionSpec: "24"
```

ğŸŒ± _This installs Node.js version 24 on your agent._

---

## ğŸ“¥ Step 2 â€” Install npm Packages

```yaml
- task: Npm@1
  inputs:
    command: "install"
    workingDir: "."
```

ğŸ“Œ Installs all dependencies from **package.json**.

---

## ğŸ“‚ Step 3 â€” Copy Files to Staging Directory

```yaml
- task: CopyFiles@2
  inputs:
    SourceFolder: "$(Build.SourcesDirectory)"
    Contents: "**"
    TargetFolder: "$(Build.ArtifactStagingDirectory)"
```

ğŸ“ Copies all project files into the artifact staging folder.

---

## ğŸ—œï¸ Step 4 â€” Archive ZIP with Build Number

```yaml
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: "$(Build.ArtifactStagingDirectory)"
    includeRootFolder: false
    archiveType: "zip"
    archiveFile: "$(Build.ArtifactStagingDirectory)/output-$(Build.BuildId).zip"
    replaceExistingArchive: true
```

ğŸ“¦ Produces ZIP files like:
â¡ï¸ `output-101.zip`
â¡ï¸ `output-202.zip`

---

## ğŸ“¤ Step 5 â€” Publish Build Artifact

```yaml
- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: "$(Build.ArtifactStagingDirectory)/output-$(Build.BuildId).zip"
    artifactName: "drop"
```

ğŸŒ This ZIP becomes the package used by the Release pipeline.

---

## ğŸš€ Step 6 â€” Deploy ZIP to Azure App Service

```yaml
- task: AzureRmWebAppDeployment@4
  inputs:
    ConnectionType: "AzureRM"
    azureSubscription: "webapp-conn"
    appType: "webAppLinux"
    WebAppName: "nodenongo"
    Package: "$(Build.ArtifactStagingDirectory)/output-$(Build.BuildId).zip"
    RuntimeStack: "NODE|18-lts"
```

ğŸŒ Deploys your Node.js app directly to Azure App Service.

---

## ğŸ‰ Final Result

âœ¨ A complete CI/CD pipeline using **only steps**, running inside one implicit:

### ğŸŸ¦ **Stage: Stage 1**

### ğŸŸ© **Job: Job**

and producing versioned ZIP artifacts deployed directly to Azure App Service.

---

If you'd like, I can also:

- ğŸ”§ Add slot deployment + autoâ€‘swap
- ğŸ— Convert this into a full multiâ€‘stage YAML pipeline
- ğŸš€ Add automatic release triggers

Just tell me! ğŸ˜„

---

# ğŸ§¾ FINAL YAML (Complete Steps-Only Pipeline) ğŸš€

```yaml
trigger:
  branches:
    include:
      - main

pool:
  name: nakodtech
  demands:
    - agent.name -equals Agent-1

variables:
  artifactName: drop

stages:
  # -------------------------
  # STAGE 1: BUILD
  # -------------------------
  - stage: Build
    displayName: "Build Stage"

    jobs:
      - job: BuildJob
        displayName: "Build and Package App"

        steps:
          - task: NodeTool@0
            inputs:
              versionSpec: "20"

          - task: Npm@1
            inputs:
              command: "install"
              workingDir: "."

          - task: CopyFiles@2
            inputs:
              SourceFolder: "$(Build.SourcesDirectory)"
              Contents: "**"
              TargetFolder: "$(Build.ArtifactStagingDirectory)"

          - task: ArchiveFiles@2
            inputs:
              rootFolderOrFile: "$(Build.ArtifactStagingDirectory)"
              includeRootFolder: false
              archiveType: "zip"
              archiveFile: "$(Build.ArtifactStagingDirectory)/webapp-$(Build.BuildId).zip"

          - task: PublishBuildArtifacts@1
            inputs:
              pathToPublish: "$(Build.ArtifactStagingDirectory)"
              artifactName: "$(artifactName)"

  # -------------------------
  # STAGE 2: DEPLOY
  # -------------------------
  - stage: Deploy
    displayName: "Deploy to Azure App Service"
    dependsOn: Build

    jobs:
      - job: DeployJob
        displayName: "Deploy WebApp"

        steps:
          - download: current
            artifact: drop

          - task: AzureRmWebAppDeployment@4
            displayName: "Deploy WebApp"
            inputs:
              ConnectionType: "AzureRM"
              azureSubscription: "webapp-conn"
              WebAppName: "nodenongo"
              appType: "webAppLinux"
              packageForLinux: "$(Pipeline.Workspace)/drop/*.zip"
```

---

ğŸ‰ **Your pipeline is now complete, readable, optimized, and fully deploys your Node.js app using only steps!**
